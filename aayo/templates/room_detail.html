{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h2>ë°©ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
    <p><span data-emoji="ğŸ·ï¸">ë°© ì´ë¦„:</span> {{ room.name }}</p>
    <p><span data-emoji="â˜•">ì¹´í˜:</span> {{ room.cafe }}</p>
    <p><span data-emoji="ğŸ”—">ë°© ë§í¬:</span> <a href="{% url 'room_menu' room.unique_id %}" id="roomLink">{{ request.build_absolute_uri }}{% url 'room_menu' room.unique_id %}</a></p>
    <button type="button" id="copyLinkBtn" class="btn btn-primary">ë§í¬ ê³µìœ í•˜ê¸°</button>
    
    <a href="{% url 'room_orders' room.unique_id %}" class="btn btn-primary">ì£¼ë¬¸ ì´ê³„ ë³´ê¸°</a>
    <a href="{% url 'room_menu' unique_id=room.unique_id %}" class="btn btn-secondary">ë°© ì…ì¥</a>
</div>

<div id="message" style="display: none;"></div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const copyLinkBtn = document.getElementById('copyLinkBtn');
    const roomLink = document.getElementById('roomLink');

    copyLinkBtn.addEventListener('click', function() {
        const linkToCopy = roomLink.href;

        if (navigator.clipboard) {
            navigator.clipboard.writeText(linkToCopy)
                .then(() => {
                    alert("ë°© ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
                })
                .catch(err => {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                    fallbackCopyTextToClipboard(linkToCopy);
                });
        } else {
            fallbackCopyTextToClipboard(linkToCopy);
        }
    });

    function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            const successful = document.execCommand('copy');
            const msg = successful ? 'ì„±ê³µì ìœ¼ë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
            alert(msg);
        } catch (err) {
            console.error('Fallback: ë³µì‚¬ ì‹¤íŒ¨', err);
            alert("ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
        }

        document.body.removeChild(textArea);
    }
});
</script>
{% endblock %}
